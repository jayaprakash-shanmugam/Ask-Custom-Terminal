<div class="dashboard-container">
    <h1>Audit Dashboard</h1>
  
    <div *ngIf="loading" class="loading-spinner">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  
    <div *ngIf="error" class="error-message">
      {{error}}
      <button mat-raised-button color="primary" (click)="loadDashboardData()">Retry</button>
    </div>
  
    <div *ngIf="!loading && !error" class="dashboard-content">
      <!-- Summary Cards -->
      <div class="stats-cards">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Client Audits</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="stat-number">{{clientTotal}}</div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button color="primary" (click)="viewAllClientAudits()">View All</button>
          </mat-card-actions>
        </mat-card>
  
        <mat-card>
          <mat-card-header>
            <mat-card-title>Model Audits</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="stat-number">{{modelTotal}}</div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button color="primary" (click)="viewAllModelAudits()">View All</button>
          </mat-card-actions>
        </mat-card>
  
        <mat-card>
          <mat-card-header>
            <mat-card-title>Audit Statistics</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="stat-text">View detailed stats</div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button color="primary" (click)="viewStats()">View Stats</button>
          </mat-card-actions>
        </mat-card>
      </div>
  
      <!-- Recent Audits Sections -->
      <div class="recent-audits-container">
        <!-- Client Audits -->
        <mat-card class="recent-audits-card">
          <mat-card-header>
            <mat-card-title>Recent Client Audits</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-nav-list *ngIf="recentClientAudits && recentClientAudits.length > 0">
              <a mat-list-item *ngFor="let audit of recentClientAudits" 
                 (click)="viewAuditDetails(audit, 'client')">
                <div class="audit-list-item">
                  <span class="event-type">{{audit.event_type}}</span>
                  <span class="message">{{audit.message}}</span>
                  <span class="timestamp">{{formatTimestamp(audit.timestamp)}}</span>
                  <button mat-icon-button *ngIf="audit.metadata?.['session_id']" 
                          (click)="$event.stopPropagation(); viewSessionAudits(audit.metadata['session_id'])" 
                          matTooltip="View session events">
                    <mat-icon>link</mat-icon>
                  </button>
                </div>
              </a>
            </mat-nav-list>
            <p *ngIf="recentClientAudits && recentClientAudits.length === 0" class="no-data">No recent client audit events.</p>
          </mat-card-content>
          <mat-card-actions *ngIf="recentClientAudits && recentClientAudits.length > 0">
            <button mat-button color="primary" (click)="viewAllClientAudits()">View All</button>
          </mat-card-actions>
        </mat-card>
  
        <!-- Model Audits -->
        <mat-card class="recent-audits-card">
          <mat-card-header>
            <mat-card-title>Recent Model Audits</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-nav-list *ngIf="recentModelAudits && recentModelAudits.length > 0">
              <a mat-list-item *ngFor="let audit of recentModelAudits" 
                 (click)="viewAuditDetails(audit, 'model')">
                <div class="audit-list-item">
                  <span class="event-type">{{audit.event_type}}</span>
                  <span class="message">{{audit.message}}</span>
                  <span class="timestamp">{{formatTimestamp(audit.timestamp)}}</span>
                  <button mat-icon-button *ngIf="audit.metadata?.['session_id']" 
                          (click)="$event.stopPropagation(); viewSessionAudits(audit.metadata['session_id'])" 
                          matTooltip="View session events">
                    <mat-icon>link</mat-icon>
                  </button>
                </div>
              </a>
            </mat-nav-list>
            <p *ngIf="recentModelAudits && recentModelAudits.length === 0" class="no-data">No recent model audit events.</p>
          </mat-card-content>
          <mat-card-actions *ngIf="recentModelAudits && recentModelAudits.length > 0">
            <button mat-button color="primary" (click)="viewAllModelAudits()">View All</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>